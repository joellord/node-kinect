<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for lib/index.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../prettify.css">
    <link rel="stylesheet" href="../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header high">
    <h1>Code coverage report for <span class="entity">lib/index.js</span></h1>
    <h2>
        Statements: <span class="metric">93.98% <small>(78 / 83)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">80% <small>(56 / 70)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">100% <small>(9 / 9)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">93.75% <small>(75 / 80)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../index.html">All files</a> &#187; <a href="index.html">lib/</a> &#187; index.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9</span>
<span class="cline-any cline-yes">9</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9</span>
<span class="cline-any cline-yes">9</span>
<span class="cline-any cline-yes">9</span>
<span class="cline-any cline-yes">9</span>
<span class="cline-any cline-yes">9</span>
<span class="cline-any cline-yes">9</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">28</span>
<span class="cline-any cline-yes">28</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">27</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">25</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">28</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">49</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">49</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">"use strict";
&nbsp;
var request = require("request");
var fs = require("fs");
&nbsp;
var config = {
  writeToFile: false
};
&nbsp;
/**
 * Constructor
 * defaults: list of options to override the config object
 **/
var RUG = function (defaults) {
  //constructor
  this.API_URL = "randomuser.me/api";
  this.LOGGER = false;
&nbsp;
  config.writeToFile = (defaults &amp;&amp; defaults.writeToFile !== undefined) ? defaults.writeToFile : false;
  config.fields = (defaults &amp;&amp; defaults.fields !== undefined) <span class="branch-0 cbranch-no" title="branch not covered" >? defaults.field</span>s : undefined;
  config.map = (defaults &amp;&amp; defaults.map !== undefined) ? defaults.map : undefined;
  config.gender = (defaults &amp;&amp; defaults.gender !== undefined) <span class="branch-0 cbranch-no" title="branch not covered" >? defaults.gende</span>r : undefined;
  config.nationality = (defaults &amp;&amp; defaults.nationality !== undefined) <span class="branch-0 cbranch-no" title="branch not covered" >? defaults.nationalit</span>y : undefined;
  config.seed = (defaults &amp;&amp; defaults.seed !== undefined) <span class="branch-0 cbranch-no" title="branch not covered" >? defaults.see</span>d : undefined;
};
&nbsp;
/**
 * getOne
 * This function will return a single user
 * cb: A callback function that is called when the function is done
 * The parameter of the function is the single user object
 **/
RUG.prototype.getOne = function (options, cb) {
  //If there is no options, cb is the first param
  if (cb === undefined &amp;&amp; typeof options === "function") {
    cb = options;
    options = {};
  }
&nbsp;
  this.log("Intiating getOne() function");
&nbsp;
  this.getMany(1, options, function (users) {
    <span class="missing-if-branch" title="else path not taken" >E</span>if (typeof cb === "function") cb(users[0]);
  });
&nbsp;
  return;
};
&nbsp;
/**
 * getMany
 * This function returns a group of users
 * howMany: A number indicating the number of users in the array
 * cb: A callback function that is called when the function is done
 * The parameter of the function is an array of users
 **/
RUG.prototype.getMany = function (howMany, options, cb) {
  //If there is no options, cb is the first param
  if (cb === undefined &amp;&amp; typeof options === "function") {
    cb = options;
    options = {};
  }
&nbsp;
  //Use defaults instead of options
  var currentScopeConfig = config;
  for (var option in options) {
    currentScopeConfig[option] = options[option];
  }
  options = currentScopeConfig;
&nbsp;
  <span class="missing-if-branch" title="if path not taken" >I</span>if (typeof howMany !== "number") {
<span class="cstat-no" title="statement not covered" >    throw "The first parameter of getMany() should be a number";</span>
  }
&nbsp;
  this.log("Intiating getMany() function");
  this.log("using options");
  this.log(options);
  var self = this;
&nbsp;
  var queryString = "?results=" + howMany;
  queryString += (options.gender) ? "&amp;gender=" + options.gender : "";
  queryString += (options.nationality) ? "&amp;nat=" + options.nationality : "";
  queryString += (options.seed) ? "&amp;seed=" + options.seed : "";
&nbsp;
  request.get("http://" + this.API_URL + queryString, function (error, response, body) {
    <span class="missing-if-branch" title="if path not taken" >I</span>if (error) {
<span class="cstat-no" title="statement not covered" >      throw "Could not reach server";</span>
    }
&nbsp;
    self.log("Got a valid response");
&nbsp;
    body = JSON.parse(body);
&nbsp;
    //If the API is down, it send an object with an error property
    <span class="missing-if-branch" title="if path not taken" >I</span>if (body.error) {
<span class="cstat-no" title="statement not covered" >      throw body.error;</span>
    }
&nbsp;
    var users = [];
&nbsp;
    for (var i = 0; i &lt; howMany; i++) {
      //Transform users
      var newUser = {};
      if (options &amp;&amp; options.fields) {
        //Only specific fields
        for (var j = 0; j &lt; options.fields.length; j++) {
          var field = options.fields[j];
          newUser[field] = (body.results[i].user[field]) ? body.results[i].user[field] <span class="branch-1 cbranch-no" title="branch not covered" >: undefine</span>d;
        }
      } else if (options &amp;&amp; options.map) {
        //Map the fields
        for (var mappedField in options.map) {
          //map: {firstName: 'name.first'}
          //mappedField if firstName and target is name.first
&nbsp;
          var target = options.map[mappedField];
&nbsp;
          //check for deep fields (ie name.first)
          var fieldValue;
          if (target.indexOf(".") &gt; -1) {
            var fields = target.split(".");
            //according to the current documentation, it can't be deeper than 2 levels
            fieldValue = body.results[i].user[fields[0]][fields[1]];
          } else {
            fieldValue = body.results[i].user[target];
          }
&nbsp;
          //Add to the new User
          newUser[mappedField] = fieldValue;
        }
      } else {
        newUser = body.results[i].user;
      }
&nbsp;
      //Then push it
      users.push(newUser);
    }
&nbsp;
    //TODO Fix this code smell
    if (config.writeToFile) {
      self.outputToFile(users, function () {
        <span class="missing-if-branch" title="else path not taken" >E</span>if (typeof cb === "function") cb(users);
      });
    } else {
      <span class="missing-if-branch" title="else path not taken" >E</span>if (typeof cb === "function") cb(users);
    }
  });
&nbsp;
  return;
};
&nbsp;
/**
 * log
 * A simple and naive console logger
 * text: The text to be logged
 **/
RUG.prototype.log = function (text) {
  <span class="missing-if-branch" title="if path not taken" >I</span>if (this.LOGGER) {
<span class="cstat-no" title="statement not covered" >    console.log(text);</span>
  }
&nbsp;
  return true;
};
&nbsp;
/**
 * outputToFile
 * This function outputs data to a filename that is specified in the config.writeToFile
 * data: Data to write to file
 * cb: The callback function
 **/
RUG.prototype.outputToFile = function (data, cb) {
  var filename = config.writeToFile || <span class="branch-1 cbranch-no" title="branch not covered" >"output.txt";</span>
&nbsp;
  this.log("Outputting to file " + config.writeToFile);
&nbsp;
  fs.writeFile(filename, JSON.stringify(data), function (err) {
    <span class="missing-if-branch" title="if path not taken" >I</span>if (err) {
<span class="cstat-no" title="statement not covered" >      throw err;</span>
    }
&nbsp;
    cb(data);
  }); 
};
&nbsp;
module.exports = RUG;
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Sep 30 2015 00:36:53 GMT-0500 (CDT)</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
